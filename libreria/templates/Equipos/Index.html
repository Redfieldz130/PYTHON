{% extends "Paginas/Base.html" %}

{% block titulo %}Inventario de Tecnología{% endblock %}

{% block JS %}
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% if messages %}
        {% for message in messages %}
            <script>
                Swal.fire({
                    title: "Mensaje",
                    text: "{{ message }}",
                    icon: "{% if message.tags == 'error' %}error{% else %}success{% endif %}"
                });
            </script>
        {% endfor %}
    {% endif %}
{% endblock %}

{% block contenido %}
<style scoped>
    :root {
        --excel-green: #217346;
        --primary-color: #4361ee;
        --secondary-color: #3f37c9;
        --accent-color: #4895ef;
        --light-color: #f8f9fa;
        --dark-color: #212529;
        --success-color: #4cc9f0;
        --warning-color: #f8961e;
        --danger-color: #f94144;
        --border-radius: 8px;
        --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
    }

    .btn-export-excel {
        background-color: var(--excel-green);
        color: white;
        border: 1px solid var(--excel-green);
    }

    .btn-export-excel:hover {
        background-color: #1a5635;
        border-color: #1a5635;
        color: #f8f9fa;
    }

    .inventory-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        box-sizing: border-box;
    }

    .inventory-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
    }

    .inventory-header h1 {
        color: var(--primary-color);
        margin-bottom: 10px;
        font-size: 2rem;
    }

    .inventory-header p {
        color: #666;
        font-size: 1.1rem;
    }

    .filter-section {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 25px;
        justify-content: center;
    }

    .filter-btn {
        padding: 10px 20px;
        border: none;
        border-radius: var(--border-radius);
        background-color: var(--light-color);
        color: var(--dark-color);
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        box-shadow: var(--box-shadow);
        font-size: 0.9rem;
    }

    .filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 8px rgba(0, 0, 0, 0.1);
    }

    .filter-btn.active {
        background-color: var(--primary-color);
        color: white;
    }

    .search-container {
        margin-bottom: 30px;
        display: flex;
        justify-content: center;
    }

    #search-input {
        padding: 12px 20px;
        width: 100%;
        max-width: 600px;
        border: 1px solid #ddd;
        border-radius: var(--border-radius);
        font-size: 16px;
        transition: var(--transition);
    }

    #search-input:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 2px rgba(72, 149, 239, 0.2);
    }

    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .product-card {
        background-color: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--box-shadow);
        transition: var(--transition);
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .product-image {
        height: 160px;
        background-color: var(--light-color);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary-color);
        font-size: 50px;
    }

    .product-info {
        padding: 20px;
        position: relative;
        overflow: hidden; /* Asegura que .product-actions no desborde */
    }

    .btn-actions {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        color: #666;
        font-size: 1.2rem;
        cursor: pointer;
        padding: 5px;
        transition: var(--transition);
    }

    .btn-actions:hover {
        color: var(--primary-color);
    }

    .product-actions {
        transform: translateX(100%); /* Inicialmente fuera a la derecha */
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
        display: flex;
        gap: 10px;
        margin-top: 15px;
        flex-wrap: wrap;
    }

    .toggle-actions:checked ~ .product-actions {
        transform: translateX(0); /* Se desliza a la posición original */
        opacity: 1;
    }

    .product-category {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .product-status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .Disponible { background-color: #c8e6c9; color: #388e3c; }
    .Asignado { background-color: #ffcdd2; color: #c62828; }

    /* Clases para los tipos de productos */
    .laptop { background-color: #e3f2fd; color: #1565c0; }
    .impresora { background-color: #ffebee; color: #c62828; }
    .cpu { background-color: #fff3e0; color: #e65100; }
    .monitor { background-color: #e0f7fa; color: #00838f; }
    .proyector { background-color: #c8e6c9; color: #388e3c; }
    .ups { background-color: #bbdefb; color: #1976d2; }
    .scanner { background-color: #fce4ec; color: #ad1457; }
    .pantalla_proyector { background-color: #e1f5fe; color: #0277bd; }
    .tablet { background-color: #f3e5f5; color: #7b1fa2; }
    .server { background-color: #ffecb3; color: #ff8f00; }
    .router { background-color: #d7ccc8; color: #5d4037; }
    .generador_tono { background-color: #e0f2f7; color: #006064; }
    .tester { background-color: #f1f8e9; color: #558b2f; }
    .multimetro { background-color: #fbe9e7; color: #bf360c; }
    .access_point { background-color: #e8f5e9; color: #2e7d32; }
    .licencia_informatica { background-color: #ede7f6; color: #5e35b1; }
    .mouse { background-color: #f5f5f5; color: #424242; }
    .teclado { background-color: #eee0e0; color: #616161; }
    .headset { background-color: #e0f2f7; color: #00838f; }
    .bocina { background-color: #f0f4c3; color: #827717; }
    .brazo_monitor { background-color: #cfd8dc; color: #455a64; }
    .memoria_usb { background-color: #e8eaf6; color: #3f51b5; }
    .pointer { background-color: #fffde7; color: #fbc02d; }
    .kit_herramientas { background-color: #fbe9e7; color: #e64a19; }
    .cartucho { background-color: #fce4ec; color: #c2185b; }
    .toner { background-color: #e0f7fa; color: #0097a7; }
    .botella_tinta { background-color: #e3f2fd; color: #2196f3; }
    .camara_web { background-color: #f3e5f5; color: #9c27b0; }
    .disco_duro { background-color: #e8f5e9; color: #43a047; }

     .product-brand{
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--dark-color);
    }

    .product-name {
        font-size: 14px;
        color: #555;
        margin-bottom: 5px;
    }

    .product-serial {
        font-size: 13px;
        color: #777;
        margin-bottom: 15px;
        font-family: monospace;
    }

    .btn-details, .btn-edit, .btn-delete, .btn-assign, .btn-release {
        background-color: var(--accent-color);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.85rem;
        flex: 1;
        text-align: center;
        text-decoration: none;
    }

    .btn-details:hover {
        background-color: var(--secondary-color);
    }

    .btn-edit {
        background-color: var(--warning-color);
    }

    .btn-delete {
        background-color: var(--danger-color);
    }

    .btn-assign {
        background-color: var(--success-color);
    }

    .btn-release {
        background-color: var(--primary-color);
    }

    .no-results {
        text-align: center;
        grid-column: 1 / -1;
        padding: 40px;
        color: #666;
    }

    .action-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
        margin-bottom: 100px;
    }

    .action-btn {
        padding: 10px 25px;
        border-radius: 50px;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        transition: var(--transition);
    }

    .action-btn i {
        margin-right: 8px;
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: white;
        border-radius: var(--border-radius);
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        position: relative;
    }

    .close-modal {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 24px;
        cursor: pointer;
        color: #666;
    }

    .feature-item {
        padding: 8px 0;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
    }

    .feature-item:last-child {
        border-bottom: none;
    }

    .feature-name {
        color: #666;
    }

    .feature-value {
        font-weight: 600;
    }

    @media (max-width: 768px) {
        .products-grid {
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        }

        .filter-section {
            flex-direction: column;
            align-items: center;
        }

        .filter-btn {
            width: 100%;
            max-width: 300px;
        }

        .product-actions {
            flex-direction: column;
        }
    }

    @media (max-width: 480px) {
        .inventory-header h3 {
            font-size: 1.5rem;
        }

        .inventory-header p {
            font-size: 1rem;
        }

        .product-card {
            width: 100%;
        }
    }
    .todo-titulo-lista{
        display:flex;
        justify-content:space-between;
        flex-wrap: wrap;  
        label{
            cursor: pointer;
        }  
        .check-lista{
            display:none;
        } 
    }
    :has(.check-lista:checked) .fa-list{
        color:#4361ee;
    }
    :has(.check-lista:checked) .products-grid{
        grid-template-columns:1fr;
        .product-card{
            display:flex;
            
            /* justify-content:space-between; */
            align-items:center;
            
            .product-image{
                margin-left:1em;
                font-size: 2em;
                padding:0;
                background:transparent;
            }
            .product-info{
                font-size:.9em;
                display: flex;
                justify-content: flex-start;
                flex: 1;
                
                
            }
            .product-main-info > * {
                display: inline-block;
                white-space: nowrap;
                margin: 0;
                padding: 0;
            }
            .product-desc{
                display:flex;
                flex-direction: column;
                gap: 0.3em;
                
            }
            .product-main-info{
                display: flex;
                flex-direction: row;
                flex-wrap: nowrap;
                gap: 0.5em;
                align-items: center;
            }
            .product-actions{
                margin-left: auto;
                display: flex;

            }
            .product-brand{
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 0;
                color: var(--dark-color);
                margin: 0;
                white-space: nowrap;
            }

            .product-name {
                font-size: 14px;
                color: #555;
                margin-bottom: 0;
                margin: 0;
                white-space: nowrap;
            }

            .product-serial {
                font-size: 13px;
                color: #777;
                margin-bottom: 0;
                font-family: monospace;
                margin: 0;
                white-space: nowrap;
            }
            .product-category {
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: bold;
                margin-bottom: 8px;
            }

            .product-status {
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: bold;
                margin-bottom: 8px;
            }
            .product-tags {
                display: flex;
                flex-direction: row;
                gap: 0.5em; /* Espacio entre tipo y estado */
                margin-bottom: 0.3em;
                flex-wrap: wrap;
                }

            .product-category,
            .product-status {
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: bold;
            }
            
            
            
        }
    }
</style>

<div class="inventory-container">
    <div class="inventory-header">
        <h3>Inventario de Tecnología</h3>
        <p>Gestiona y consulta todos los equipos, accesorios, licencias y materiales</p>
    </div>

    <div class="filter-section">
        <button class="filter-btn active" data-category="todos">Todos</button>
        <button class="filter-btn" data-category="equipos">Equipos</button>
        <button class="filter-btn" data-category="accesorios">Accesorios</button>
        <button class="filter-btn" data-category="licencias">Licencias</button>
        <button class="filter-btn" data-category="materiales">Materiales</button>
    </div>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="Buscar por Tipo de equipo, Marca, Modelo o Serial...">
    </div>

    <!-- Sección: Todos -->
    <div id="todos-section">
        <div class="todo-titulo-lista">
            <h2>Todos los elementos</h2>
            <label >
                <i class="fa-solid fa-list"></i>
                <input type="checkbox" class='check-lista' />
            </label>
        </div>
        <div class="products-grid">
            {% for equipo in equipos_por_categoria.todos %}
                {% include 'Equipos/partials/teclado_equipo.html' with equipo=equipo %}
            {% empty %}
                <div class="no-results">
                    <h3>No se encontraron elementos</h3>
                    <p>No hay elementos registrados en el inventario.</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Sección: Equipos -->
    <div id="equipos-section" style="display:none;">
        <h2>Equipos</h2>
        <div class="products-grid">
            {% for equipo in equipos_por_categoria.equipos %}
                {% include 'Equipos/partials/teclado_equipo.html' with equipo=equipo %}
            {% empty %}
                <div class="no-results">
                    <h3>No se encontraron equipos</h3>
                    <p>No hay equipos registrados.</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Sección: Accesorios -->
    <div id="accesorios-section" style="display:none;">
        <h2>Accesorios</h2>
        <div class="products-grid">
            {% for equipo in equipos_por_categoria.accesorios %}
                {% include 'Equipos/partials/teclado_equipo.html' with equipo=equipo %}
            {% empty %}
                <div class="no-results">
                    <h3>No se encontraron accesorios</h3>
                    <p>No hay accesorios registrados.</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Sección: Licencias -->
    <div id="licencias-section" style="display:none;">
        <h2>Licencias</h2>
        <div class="products-grid">
            {% for equipo in equipos_por_categoria.licencias %}
                {% include 'Equipos/partials/teclado_equipo.html' with equipo=equipo %}
            {% empty %}
                <div class="no-results">
                    <h3>No se encontraron licencias</h3>
                    <p>No hay licencias registradas.</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Sección: Materiales -->
    <div id="materiales-section" style="display:none;">
        <h2>Materiales</h2>
        <div class="products-grid">
            {% for equipo in equipos_por_categoria.materiales %}
                {% include 'Equipos/partials/teclado_equipo.html' with equipo=equipo %}
            {% empty %}
                <div class="no-results">
                    <h3>No se encontraron materiales</h3>
                    <p>No hay materiales registrados.</p>
                </div>
            {% endfor %}
        </div>
    </div>

    {% if perms.libreria.add_equipo %}
    <div class="action-buttons">
        <a href="{% url 'crear_equipo' %}" class="action-btn btn btn-primary">
            <i class="fas fa-plus"></i> Agregar Equipo
        </a>
        <a href="{% url 'exportar_excel' %}" class="action-btn btn btn-export-excel">
            <i class="fas fa-file-excel"></i> Exportar a Excel
        </a>
    </div>
    {% endif %}

    <!-- Modal para detalles -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">×</span>
            <h3 id="modal-product-name"></h3>
            <div id="modal-product-details"></div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const filterButtons = document.querySelectorAll('.filter-btn');
    const sections = document.querySelectorAll('div[id$="-section"]');
    const searchInput = document.getElementById('search-input');
    const productCards = document.querySelectorAll('.product-card');
    const modal = document.getElementById('productModal');
    const closeModal = document.querySelector('.close-modal');
    const modalProductName = document.getElementById('modal-product-name');
    const modalProductDetails = document.getElementById('modal-product-details');

    // Calcular el ancho de la barra de desplazamiento
    const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;

    // Manejar el cambio de categoría
    filterButtons.forEach(button => {
        button.addEventListener('click', function () {
            const category = this.getAttribute('data-category');
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');

            sections.forEach(section => {
                section.style.display = section.id === `${category}-section` ? 'block' : 'none';
            });

            // Resetear búsqueda al cambiar de categoría
            searchInput.value = '';
            productCards.forEach(card => card.style.display = 'block');
            document.querySelectorAll('.no-results').forEach(noResult => noResult.style.display = 'none');
        });
    });

    // Filtrado por búsqueda
    searchInput.addEventListener('input', function () {
        const searchTerm = this.value.toLowerCase();
        const activeSection = document.querySelector('div[id$="-section"]:not([style*="display: none"])');
        const cards = activeSection.querySelectorAll('.product-card');

        cards.forEach(card => {
            const brand = card.querySelector('.product-brand').textContent.toLowerCase();
            const category = card.querySelector('.product-category').textContent.toLowerCase();
            const model = card.querySelector('.product-name').textContent.toLowerCase();
            const serial = card.querySelector('.product-serial').textContent.toLowerCase();
            const matches = brand.includes(searchTerm) || model.includes(searchTerm) || serial.includes(searchTerm) || category.includes(searchTerm);
            card.style.display = matches ? 'block' : 'none';
        });

        // Mostrar mensaje si no hay resultados
        const visibleCards = Array.from(cards).filter(card => card.style.display !== 'none');
        const noResults = activeSection.querySelector('.no-results');
        if (visibleCards.length === 0) {
            noResults.style.display = 'block';
        } else {
            noResults.style.display = 'none';
        }
    });

    // Mostrar detalles del producto en el modal
    document.querySelectorAll('.btn-details').forEach(button => {
        button.addEventListener('click', function () {
            const card = this.closest('.product-card');
            const productName = card.querySelector('.product-name').textContent;
            const details = JSON.parse(this.getAttribute('data-details'));

            modalProductName.textContent = productName;
            modalProductDetails.innerHTML = '';

            // Definir campos generales según la matriz
            const generalFields = {
                'tipo': 'Tipo',
                'marca': 'Marca',
                'modelo': 'Modelo',
                'serial': 'Serial',
                'fecha_compra': 'Fecha de Compra',
                'valor_compra': 'Valor de Compra',
                'ubicacion': 'Ubicación',
                'empleado_responsable': 'Empleado Responsable',
                'proveedor': 'Proveedor',
                'fecha_fabricacion': 'Fecha de Fabricación',
                'vida_util_anios': 'Vida Útil (Años)',
                'nombre_red': 'Nombre de Red',
                'fecha_recepcion': 'Fecha de Recepción',
                'fecha_mantenimiento': 'Fecha de Mantenimiento',
                'observaciones': 'Observaciones'
            };

            // Definir campos específicos según la matriz
            const deviceFields = {
                'laptop': ['mac_address', 'procesador_marca', 'procesador_velocidad', 'procesador_generacion', 'sistema_operativo', 'sistema_operativo_version', 'sistema_operativo_bits', 'almacenamiento_capacidad', 'memoria', 'size_pantalla', 'resolucion'],
                'impresora': ['impresora_tipo', 'impresora_velocidad_ppm', 'impresora_color', 'impresora_conexion'],
                'cpu': ['mac_address', 'procesador_marca', 'procesador_velocidad', 'procesador_generacion', 'memoria', 'cpu_formato_diseno'],
                'monitor': ['size_pantalla', 'resolucion'],
                'proyector': ['size_pantalla', 'resolucion', 'proyector_lumens'],
                'ups': ['ups_vatios', 'ups_fecha_bateria'],
                'scanner': ['scanner_velocidad', 'scanner_color'],
                'pantalla_proyector': ['size_pantalla', 'pantalla_proyector_tipo'],
                'tablet': ['mac_address', 'sistema_operativo', 'sistema_operativo_version', 'sistema_operativo_bits', 'almacenamiento_capacidad', 'memoria', 'size_pantalla'],
                'server': ['mac_address', 'procesador_marca', 'procesador_velocidad', 'procesador_generacion', 'memoria', 'almacenamiento_capacidad', 'server_numero_procesadores'],
                'router': [],
                'generador_tono': [],
                'tester': [],
                'multimetro': [],
                'access_point': [],
                'licencia_informatica': ['licencia_tipo', 'licencia_clase'],
                'mouse': ['mouse_tipo', 'mouse_conexion'],
                'teclado': [],
                'headset': [],
                'bocina': [],
                'brazo_monitor': [],
                'memoria_usb': [],
                'pointer': [],
                'kit_herramientas': [],
                'cartucho': [],
                'toner': [],
                'botella_tinta': [],
                'camara_web': [],
                'disco_duro': ['almacenamiento_capacidad', 'clase_disco']
            };

            // Mapa de nombres de campos para mostrar en el modal
            const fieldNames = {
                'mac_address': 'Dirección MAC',
                'procesador_marca': 'Marca del Procesador',
                'procesador_velocidad': 'Velocidad del Procesador (GHz)',
                'procesador_generacion': 'Generación del Procesador',
                'sistema_operativo': 'Sistema Operativo',
                'sistema_operativo_version': 'Versión del Sistema Operativo',
                'sistema_operativo_bits': 'Bits del Sistema Operativo',
                'almacenamiento_capacidad': 'Capacidad de Almacenamiento (GB)',
                'memoria': 'Memoria (GB)',
                'size_pantalla': 'Tamaño de Pantalla (pulgadas)',
                'resolucion': 'Resolución',
                'impresora_tipo': 'Tipo de Impresora',
                'impresora_velocidad_ppm': 'Velocidad (PPM)',
                'impresora_color': 'Color',
                'impresora_conexion': 'Conexión',
                'proyector_lumens': 'Lúmenes',
                'ups_vatios': 'Vatios',
                'ups_fecha_bateria': 'Fecha de Batería',
                'scanner_velocidad': 'Velocidad',
                'scanner_color': 'Color',
                'pantalla_proyector_tipo': 'Tipo de Pantalla',
                'server_numero_procesadores': 'Número de Procesadores',
                'licencia_tipo': 'Tipo de Licencia',
                'licencia_clase': 'Clase de Licencia',
                'mouse_tipo': 'Tipo de Mouse',
                'mouse_conexion': 'Conexión',
                'clase_disco': 'Clase de Disco',
                'cpu_formato_diseno': 'Formato/Diseño'
            };

            // Mostrar campos generales
            for (const [key, label] of Object.entries(generalFields)) {
                if (details[key]) {
                    const div = document.createElement('div');
                    div.className = 'feature-item';
                    div.innerHTML = `<span class="feature-name">${label}</span><span class="feature-value">${details[key]}</span>`;
                    modalProductDetails.appendChild(div);
                }
            }

            // Mostrar campos específicos según el tipo
            const tipo = details['tipo'].toLowerCase();
            if (deviceFields[tipo]) {
                deviceFields[tipo].forEach(field => {
                    if (details[field]) {
                        const div = document.createElement('div');
                        div.className = 'feature-item';
                        div.innerHTML = `<span class="feature-name">${fieldNames[field]}</span><span class="feature-value">${details[field]}</span>`;
                        modalProductDetails.appendChild(div);
                    }
                });
            }

            // Agregar clase modal-open y compensar el ancho de la barra
            document.body.classList.add('modal-open');
            document.body.style.marginRight = `${scrollbarWidth}px`;
            modal.style.display = 'flex';
        });
    });

    // Cerrar el modal
    closeModal.addEventListener('click', function () {
        document.body.classList.remove('modal-open');
        document.body.style.marginRight = '0px';
        modal.style.display = 'none';
    });

    // Cerrar el modal al clicar fuera de él
    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            document.body.classList.remove('modal-open');
            document.body.style.marginRight = '0px';
            modal.style.display = 'none';
        }
    });
});
</script>

{% endblock %}