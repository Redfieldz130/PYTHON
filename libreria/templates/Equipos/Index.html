{% extends "Paginas/Base.html" %}
{% load static %}
{% block titulo %}Inventario de Tecnología{% endblock %}
{% block JS %}
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
{% endblock %}

{% block contenido %}
<link rel="stylesheet" href="{% static 'css/index.css' %}?v=1.0">
{% if messages %}
        {% for message in messages %}
            <script>
                Swal.fire({
                    title: "Mensaje",
                    text: "{{ message }}",
                    icon: "{% if message.tags == 'error' %}error{% else %}success{% endif %}"
                });
            </script>
        {% endfor %}
    {% endif %}

<div class="inventory-container">
    <div class="inventory-header">
        <h3>Inventario de Tecnología</h3>
        <p>Gestiona y consulta todos los equipos, accesorios, licencias y materiales</p>
    </div>

    <div class="filter-section">
        <button class="filter-btn active" data-category="todos">Todos</button>
        <button class="filter-btn" data-category="equipos">Equipos</button>
        <button class="filter-btn" data-category="accesorios">Accesorios</button>
        <button class="filter-btn" data-category="licencias">Licencias</button>
        <button class="filter-btn" data-category="materiales">Materiales</button>
    </div>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="Buscar por Tipo de equipo, Marca, Modelo o Serial...">
    </div>

    {% if perms.libreria.add_equipo %}
    <div class="action-buttons">
        <a href="{% url 'crear_equipo' %}" class="action-btn btn btn-primary">
            <i class="fas fa-plus"></i> Agregar Equipo
        </a>
        <a href="#" id="exportar-excel-btn" class="action-btn btn btn-export-excel" data-category="todos">
        <i class="fas fa-file-excel"></i> Exportar a Excel
        </a>
        <a href="{% url 'importar_excel' %}" class="action-btn btn btn-export-excel"><i class="fas fa-file-excel"></i> Importar excel</a>
    </div>
    {% endif %}

    <!-- Sección: Todos -->
     <div class="box-check-lista">
         <label>
             <i class="fa-solid fa-list"></i>
             <input type="checkbox" class='check-lista' />
         </label>
     </div>
    <div id="todos-section">
        <div class="todo-titulo-lista">
            <h2>Todos los elementos</h2>
        </div>
        <div class="products-grid">
            {% for equipo in equipos_por_categoria.todos %}
                {% include 'Equipos/partials/teclado_equipo.html' with equipo=equipo %}
            {% empty %}
                <div class="no-results" data-default-title="No se encontraron elementos" data-default-text="No hay elementos registrados en el inventario.">
                    <h4>No hay elementos registrados en el inventario.</h4>
                </div>
            {% endfor %}
        </div>
        <button class="load-more-btn" data-section="todos">Cargar más</button>
        <button class="show-less-btn" data-section="todos" style="display:none;">Mostrar menos</button>
    </div>

    <!-- Sección: Equipos -->
    <div id="equipos-section" style="display:none;">
        <h2>Equipos</h2>
        <div class="products-grid">
            {% for equipo in equipos_por_categoria.equipos %}
                {% include 'Equipos/partials/teclado_equipo.html' with equipo=equipo %}
            {% endfor %}
            <div class="no-results" style="display:none"
                 data-default-title="No se encontraron equipos"
                 data-default-text="No hay equipos registrados.">
                <h4>No hay equipos registrados.</h4>
            </div>
        </div>
        <button class="load-more-btn" data-section="equipos">Cargar más</button>
    </div>

    <!-- Sección: Accesorios -->
    <div id="accesorios-section" style="display:none;">
        <h2>Accesorios</h2>
        <div class="products-grid">
            {% for equipo in equipos_por_categoria.accesorios %}
                {% include 'Equipos/partials/teclado_equipo.html' with equipo=equipo %}
            {% empty %}
                <div class="no-results" data-default-title="No se encontraron accesorios" data-default-text="No hay accesorios registrados.">
                    <h4>No hay accesorios registrados.</h4>
                </div>
            {% endfor %}
        </div>
        <button class="load-more-btn" data-section="accesorios">Cargar más</button>
    </div>

    <!-- Sección: Licencias -->
    <div id="licencias-section" style="display:none;">
        <h2>Licencias</h2>
        <div class="products-grid">
            {% for equipo in equipos_por_categoria.licencias %}
                {% include 'Equipos/partials/teclado_equipo.html' with equipo=equipo %}
            {% empty %}
                <div class="no-results" data-default-title="No se encontraron licencias" data-default-text="No hay licencias registradas.">
                    <h4>No hay licencias registradas.</h4>
                </div>
            {% endfor %}
        </div>
        <button class="load-more-btn" data-section="licencias">Cargar más</button>
    </div>

    <!-- Sección: Materiales -->
    <div id="materiales-section" style="display:none;">
        <h2>Materiales</h2>
        <div class="products-grid">
            {% for equipo in equipos_por_categoria.materiales %}
                {% include 'Equipos/partials/teclado_equipo.html' with equipo=equipo %}
            {% empty %}
                <div class="no-results" data-default-title="No se encontraron materiales" data-default-text="No hay materiales registrados.">
                    <h4>No hay materiales registrados.</h4>
                </div>
            {% endfor %}
        </div>
        <button class="load-more-btn" data-section="materiales">Cargar más</button>
    </div>

    <!-- Modal para Detalles -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">×</span>
            <h3 id="modal-product-name"></h3>
            <div id="modal-product-details"></div>
        </div>
    </div>
</div>
{% endblock %}